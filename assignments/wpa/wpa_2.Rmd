---
title: "WPA #2  -- Indexing Vectors"
---


```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width=12, fig.height=8,
                      echo=FALSE, warning=FALSE, message=FALSE, eval=FALSE)
```

Open a new R script in R and save it as `wpa_X_LastFirst.R` (where Last and First is your last and first name). At the top of your script, write the assignment number, your name and date in comments. When you answer a task, indicate which task you are answering with appopriate comments.


```{r, echo = F}
set.seed(100)
cologne <- rep(c("gio", "calvinklein"), each = 100)

bar <- c(c(rep("paddys", 10), rep("grenzwert", 90)),
                 c(rep("paddys", 90), rep("grenzwert", 10)))

time <- rep(0, 200)

bar.lu <- data.frame(bar = c("grenzwert", "paddys"),
                             bar.num = c(10, 160),
                             stringsAsFactors = F)

cologne.lu <- data.frame(cologne = c("gio", "calvinklein"),
                             cologne.num = c(120, 10),
                             stringsAsFactors = F)

for(i in 1:length(time)) {
  
  cologne.i <- cologne[i]
  bar.i <- bar[i]
  
  cologne.i.num <- subset(cologne.lu, cologne == cologne.i)$cologne.num
  bar.i.num <- subset(bar.lu, bar == bar.i)$bar.num
  
  time.i <- round(rnorm(1, mean = cologne.i.num + bar.i.num + 15, sd = 10), 0)
  
  time[i] <- time.i
  
}

id <- paste(substr(bar, 1, 1), ".", rep(1:100, times = 2), sep = "")
sex <- sample(rep(c("m", "f"), times = 100), size = 200)

cologne.df <- data.frame(id, sex, cologne, bar, time, stringsAsFactors = F)
cologne.df <- cologne.df[sample(1:nrow(cologne.df)),]

id <- cologne.df$id
sex <- cologne.df$sex
cologne <- cologne.df$cologne
bar <- cologne.df$bar
time <- cologne.df$time

save(id, sex, cologne, bar, time, file = "data/wpa2.RData")

# aggregate(time ~ cologne, data = cologne.df, FUN = mean)
# aggregate(time ~ bar, data = cologne.df, FUN = mean)
# aggregate(time ~ bar + cologne, data = cologne.df, FUN = mean)
```
# Analyzing Bar survey data

<img src="http://mainetoday.com/wp-content/uploads/2014/06/meet-at-bar-red-lipstick-project.jpg" width="400" />

The following contain (fictional!) data from a survey of 200 people at one of two bars in Basel (Grenzwert and Paddy's) last Friday night at 3:00am. Each person was asked which kind of cologne they were wearing. After answering this question, a (very busy) researcher recorded how long each person spent talking to people at the bar. The data are stored in the following 5 vector objects:

- `id`: An id indicating the participant in the form `x.n`, where `x` is the name of the bar the participant was at, and `n` is a random indexing number)
- `sex`: The person's sex: `male` or `female`
- `cologne`: Which cologne did the person wear? `gio` or `calvinklein`
- `bar`: Where the person went out: `grenzwert` or `paddys`
- `time`: The amount of time the person spent talking to people in minutes

Thankfully, you don't need to type in the data yourself! The objects are stored in an *RData* file online.

A. Load the vectors into your R session by running the following code.

```{r echo = TRUE}
load(file = url("https://dl.dropboxusercontent.com/u/7618380/wpa2.RData"))
```

B. The `str()` function will give you basic information about objects. Get to know the objects (`id`, `sex`, `cologne`, `bar`, `time`) by running the `str()` function on each of the 5 vectors. 


## Review

1. How many people were there of each sex? (Hint: use `table()`)

```{r eval = FALSE, echo = FALSE}
table(sex)
```

2. What was the mean time?

```{r eval = FALSE, echo = FALSE}
mean(time)
```

3. What was the standard deviation of times?

```{r eval = FALSE, echo = FALSE}
sd(time)
```

4. Create `time.z` a z-score transformation of time. (Hint: z-score is defined as `(x - mean(x)) / sd(x)`)


## Numerical Indexing

5. What was the value of the first time?

```{r}
time[1]
```


6. What were the sexes of the first five participants?

```{r}
sex[1:5]
```


7. What were the colognes of the 10th through the 20th participants

```{r}
cologne[10:20]
```

8. Which bar did the last participant go to? (hint: don't write the indexing number directly; instead, index the vector using the `length()` function with the appropriate argument)

```{r}
bar[length(bar)]
```


## Logical Indexing on one variable

9. a) How many people wore gio? b) How many wore calvinklein?

```{r}
sum(cologne == "fun")
sum(cologne == "meet")
```

10. a) How many people went to Grenzwert? b) How many went to Paddys?

```{r}
sum(bar == "grenzwert")
sum(bar == "paddys")
```


11. What percent of people went to Grenzert? (Hint: use `mean()` combined with a logical vector)

```{r}
mean(bar == "grenzwert")
```


12. How many talking times were longer than 30 minutes?

```{r}
sum(time > 30)
```

13. What percent of talking times were longer than an hour?

```{r}
mean(time > 60)
```

14. What percent of talking times were longer than 20 minutes but less than 40 minutes?

```{r}
mean(time > 20 & time < 40)
```

## Logical indexing and two variables

15. What were the ids of people who went to grenzwert?

```{r}
id[bar == "grenzwert"]
```


16. What was the mean time of people who went to Grenzwert?

```{r}
mean(time[bar == "grenzwert"])
```

17. What was the mean time of people who went to Paddys?

```{r}
mean(time[bar == "paddys"])
```

18. What was the mean time of people who wore gio?

```{r}
mean(time[cologne == "gio"])
```


19. What was the mean time of people who wore calvinklein?

```{r}
mean(time[cologne == "calvinklein"])
```

20. Based on what you've learned, if someone wants to talk as much (I should have said as *long*) as possible, what cologne should they wear?

```{r}
# They should wear calvinklein!
```


## Changing data in a vector with indexing

In the next questions, we'll use indexing and assignment to change the values within a vector. Because we don't want to change the original data, we'll make all of our adjustments on new vectors.

21. Create new objects `bar.r`, `cologne.r` and `time.r` that are copies of the original `bar`, `cologne` and `time` objects (Hint: Just assign the existing vectors to new objects)

```{r}
bar.r <- bar
cologne.r <- cologne.r
time.r <- time
```

22. a) In the `bar.r` vector, change the `"grenzwert"` values to `"g"`. b) Now change the `"paddys"` values to `"p"`
```{r}
bar.r[bar == "grenzwert"] <- "g"
bar.r[bar == "paddys"] <- "p"
```

23. a) In the `cologne.r` vector, change the `"gio"` values to `"G"`. b) Now change the `"calvinklein"` values to `"C"`

```{r}
cologne.r[cologne == "gio"] <- "G"
cologne.r[cologne == "calvinklein"] <- "C"
```

24. In the `time.r` vector, change all time values greater than 280 to 280. Confirm that you did it correctly by calculating the maximum time in `time.r`

```{r}
time.r[time > 280] <- 280
max(time.r)
```

# Checkpoint!!! ----------------------------



## Solving a paradox...

<img src="http://home.adelphi.edu/~stemkoski/mathematrix/e-waterfall.jpg" width="200" />

25. Based on what you've learned so far, if someone wanted to talk to people as long as possible, what cologne should they wear?

*Let's see if your prediction holds up!*

26. What was the mean time of people who went to Grenzwert and wore gio??

27. What was the mean time of people who went to Grenzwert and wore calvinklein?

28. What was the mean time of people who went to Paddys who wore gio?

29. What was the mean time of people who went to Paddys who wore calvinklein??

20. Based on what you've learned now, if someone's goal is to talk to people as long as possible, what cologne should they wear?

You can visualize the data using the following code

```{r eval = F, echo = TRUE}
# Combine vectors in a dataframe
survey.df <- data.frame(bar, cologne, time)
# Create a pirateplot of the data
yarrr:::pirateplot(time ~ cologne + bar, data = survey.df)
```


What you've just seen is an example of **Simpson's Paradox**. If you want to learn more, check out [the wikipedia page](https://en.wikipedia.org/wiki/Simpson%27s_paradox).




## Some bigger challenges...

31. What percent of women wore calvinklein?

32. What was the median time of people who went to grenzwert and wore gio but who talked more than 100 minutes?

33. What percent of participants *either* went to grenzwert and talked for less than 220 minutes *or* went to paddys and talked for more than 150 minutes but no longer than 250 minutes?

34. Let's make the calvinklein wearers look better. For all of the calvinklein wearers, add a random sample from a normal distribution with mean 30 and standard deviation 5 to their original talking times.

## Submit!

Save and email your `wpa_X_LastFirst.R` file to me at nathaniel.phillips@unibas.ch. Then, go to [https://goo.gl/forms/8pKm39PMS29JoLjI2](https://goo.gl/forms/8pKm39PMS29JoLjI2) to complete the WPA submission form.

