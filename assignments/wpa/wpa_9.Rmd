---
title: "WPA #9  -- Loops and Functions"
output: html_document
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width=12, fig.height=8,
                      echo=FALSE, warning=FALSE, message=FALSE, eval=FALSE, fig.align = 'center', out.width = "70%")

student_m <- read.table("https://raw.githubusercontent.com/ndphillips/IntroductionR_Course/master/assignments/wpa/data/studentmath.txt",
                      sep = "\t",
                      header = TRUE)

student_p <- read.table("https://raw.githubusercontent.com/ndphillips/IntroductionR_Course/master/assignments/wpa/data/studentpor.txt",
                      sep = "\t",
                      header = TRUE)
```


## Readings

This assignment is based on the following readings:

- YaRrr: [16](https://bookdown.org/ndphillips/YaRrr/functions.html), [17](https://bookdown.org/ndphillips/YaRrr/loops.html) 

## Assignment Goals

- Create loops with `for`
- Use `if` statements
- Create custom functions

## Examples

```{r, echo = TRUE, eval = FALSE}

# print integers from 1 to 100

for(i in 1:100) {
  
  print(i)
  
}

# Define some number x
x <- 2

# Test if x is even
even.test <- round(x / 2, 0) == (x / 2)

# Print 'x is even' if even.test is true, otherwose, print 'x is not even!'
if(even.test == TRUE) {
  
  print("x is even!")} else {
    
    print("x is not even!")}
  

# Create a function is.even that tests if an input is even or not

is.even <- function(x,     # The number to test
                    print.result = FALSE) {
  
  # Test if x is even
even.test <- round(x / 2, 0) == (x / 2)

# Print 'x is even' if even.test is true, otherwose, print 'x is not even!'

if(print.result) {
  
if(even.test == TRUE) {
  
  message("x is even!")} else {
    
    message("x is not even!")}
  
}

return(even.test)

}

# Try our new function!

is.even(2)
is.even(3)

is.even(2, print.result = TRUE)
is.even(3, print.result = TRUE)

```


1. Open your class R project. Open a new script and enter your name, date, and the wpa number at the top. Save the script in the `R` folder in your project working directory as `wpa_9_LastFirst.R`, where Last and First are your last and first names. 


### Loops

1. Write a loop that prints the integers from 1 to 50 to the console using either the `print()` or `message()` function.

2. Now repeat the loop, but now print the square of every integer from 1 to 50. That is, it should print 1, 4, 9, 16, ...

3. 

```{r}
large_data <- matrix(c(sample(1:9, size = 100 * 100 - 1, replace = TRUE), 100), 
                     nrow = 100, 
                     ncol = 100)



```



#### Use a loop to read and write data files

3. The following loop will create write 100 text files to the data folder of your working directory (Note: It will only work if you have a data folder in your working directory!!!). Run it and see what happens!

```{r, eval = FALSE}
for (i in 1:100) {
  
  # Create a random dataset from a hypothetical subject
  data.temp <- data.frame(subject = rep(i, 10),
                          trial = 1:10,
                          response = sample(1:7, size = 10, replace = TRUE))
  
  # Write the data to a text file
  write.table(data.temp, file = paste0("data/subject_", i, ".txt"), sep = "\t")
  
}
```

4. The following code will load each data file into your R session as 100 new objects called `subject_1`, `subject_2`, ... `subject_100`. Run the code, then try looking at some of the objects such as `subject_40` and `subject_64`.

```{r}
for (i in 1:100) {
  
  # Load the data from participant i to a temporary object x
  x <- read.table(file = paste0("data/subject_", i, ".txt"), 
                  header = TRUE, 
                  sep = "\t")
  
  # Create a new object subject_i containing the data!
  assign(x = paste0("subject_", i), value = x)

}
```

5. The code above wrote all of the data to separate objects. But wouldn't it be better if, instead, the code created one large dataframe containing the data from all participants? The following code chunk will do just that by using the `rbind()` function. Look at the following code, and then run it to create a new dataframe object called `all_data` which contains the data from all participants!

```{r}
for (i in 1:100) {
  
  # Load the data from participant i to a temporary object x
  x <- read.table(file = paste0("data/subject_", i, ".txt"), 
                  header = TRUE, 
                  sep = "\t")
  
  # If it's the first subject, then make all_data equal to x
  if(i == 1) {
    
    all_data <- x
  
  # If it's NOT the first subject, then add x to all_data!
  } else {
      
    all_data <- rbind(all_data, x)
  }

}
```



## Custom Functions

5. Write a function called `feed.me()` that takes a string `food` as an argument, and returns the sentence "I love to eat ___". Try your function by running `feed.me("apples")`.

```{r, eval = FALSE, echo = TRUE}
feed.me <- function(___) {
  
  output <- paste0("I love to eat ", ___)
  
  return(___)
}
```

6. Write a function called `my.mean()` that takes a vector `x` as an argument, and returns the mean of the vector `x`. Don't use the `mean()` function! Use `sum()` and `length()`!

```{r, eval = FALSE, echo = TRUE}
my.mean <- function(___) {
  
  result <- sum(___) / length(___)
  
  return(result)
  
}
```

7. Try your `my.mean()` function to calculate the mean age of pirates in the `pirate` data frame and compare your results to what you get from using the `mean() function.

8. Write a function called `how.many.na()` that takes a vector `x` as an argument, and returns the number of NA values found in the vector:

```{r eval = FALSE, echo = TRUE}
how.many.na <- function(x) {
  
  output <- sum(is.na(___))
  
  return(___)
}
```

9. Test your `how.many.na()` function to the vector `x = c(4, 7, 3, NA, NA, 1)`

15. Write a function called `ttest.apa()` that takes a vector `x` as an argument and returns an apa style conclusion from a one-sample test of `x`.

```{r eval = FALSE}
ttest.apa <- function(x, mu) {
  
   # Store the one-sample ttest in object a
  
  a <- t.test(x = ___, 
              mu = ___) 
  
  df <- a$parameter  # Get the degrees of freedom
  test.stat <- ___      # Get the test statistic
  p.value <- ___        # Get the p-value
  
  
  # If the test is significant...
  if(p.value <= ___) {
    
    output <- paste0("The test is significant! t(",
                     df, ") = ", test.stat, 
                   ", p = ", p.value, 
                   " (H0 = ", mu, ")")
  }
  
  # If the test is not significant...
    if(p.value > ___) {
    
    output <- ___
    
  }
  
  print(___)  
}
```

16. Test your `ttest.apa()` function on the the dateability of participants in the facebook study (available at https://raw.githubusercontent.com/ndphillips/IntroductionR_Course/master/assignments/wpa/data/facebook.txt). Specifically, test if their mean dateability rating is different from 50



# More loops!


17. The following dataframe `survey` contains results from a survey of 5 participants. Each participant was asked 5 questions on a 1-10 likert scale. As you can see, many of the responses are not valid integers from 1-10. Using a loop, create a new dataframe called `survey.corrected` that converts all invalid values to NA:

```{r}
survey <- data.frame("p" = c(1, 2, 3, 4, 5),
                     "q1" = c(5, 3, 6, 3, 5),
                     "q2" = c(-1, 4, 3, 6, 11),
                     "q3" = c(6, 22, 4, 6, -5),
                     "q4" = c(6, 3, 4, -2, 4),
                     "q5" = c(1, 1, 900, 1, 2))
```

```{r eval = FALSE}
survey.corrected <- survey   # COPY SURVEY

for(column.i in ____ ) {  # LOOP OVER COLUMNS
 
  x <- ____   # COPY THE ORIGINAL COLUMN as x
  x[(x %in% ___) == FALSE] <- ___  # REPLACE
  
  survey.corrected[,___] <- ___ # ASSIGN x back to survey.correced
  
}
```



# Simulation!

18. What is the probability of getting a significant p-value if the null hypothesis is true? Test this by conducting the following simulation:

  - Create a vector called `p.values` with 100 NA values. 
  - Draw a sample of size 10 from a normal distribution with mean = 0 and standard deviation = 1.
  - Do a one-sample t-test testing if the mean of the distribution is different from 0. Save the p-value from this test in the 1st position of `p.values`.
  - Repeat these steps with a loop to fill `p.values` with 100 p-values.
  - Create a histogram of `p.values` and calculate the proportion of `p-values` that are significant at the .05 level.
  
```{r eval = FALSE}
p.values <- rep(NA, ___)

for(i in ___) {

x <- rnorm(n = ___, mean = ___, sd = ___)

result <- t.test(___)$___

p.values[___] <- ___

}
```
  
  
19. Create a function called `psimulation` with 4 arguments: `sim`: the number of simulations, `samplesize`: the sample size, `mu.true`: the true mean, and `sd.true`: the true standard deviation. Your function should repeat the simulation from the previous question with the given arguments. That is, it should calculate `sim` p-values testing whether `samplesize` samples from a normal distribution with mean = `mu.true` and standard deviation = `sd.true` is significantly different from 0. The function should return a vector of p-values. 



## Submit!

- Save and email your `wpa_9_LastFirst.R` file to me at nathaniel.phillips@unibas.ch.
- Go to [https://goo.gl/forms/b9dcRH6Ud3pDagOr1](https://goo.gl/forms/b9dcRH6Ud3pDagOr1) to confirm your assignment submission.

